## Проект
Telegram-бот для более удобной игры в Terraforming Mars онлайн.

### Подробности
Terraforming Mars - браузерная игра с [открытым исходным кодом](https://github.com/terraforming-mars/terraforming-mars), онлайн-версия одноименной настольной игры. В игру могут играть до 6 игроков, которые соревнуются друг с другом. Игра состоит из нескольких (около 10) раундов, в каждом из которых игроки поочередно делают ходы, разыгрывая карты и выполняя некоторые другие действия.

Мотивация для написания бота. Поскольку игроки не находятся за одним столом, а одновременно ходит только один игрок, партия может продолжаться несколько дней: каждый игрок делает ход тогда, когда вспомнил об игре. Если игроки хотят ускорить партию, но не имеют возможности выделить на нее несколько часов подряд, разумный способ - создать чат в каком-либо мессенджере, где напоминать друг другу, чей сейчас ход. Эти действия и призван автоматизировать предлагаемый бот.

Автоматизация возможна благодаря наличию у движка игры HTTP API, которым и пользуется бот. 

### Возможности и настройка
Преполагается, что создан чат в telegram, где находятся все или некоторые из игроков, и в этот же чат добавлен бот. Одновременно в одном чате бот может обслуживать только одну партию (но после её окончания в этом же чате можно играть следующую).

Базовая последовательность действий:
1. Создать партию через интерфейс игры, игрокам раздать личные ссылки для входа в игру.
2. Скопировать идентификатор сессии из ссылки наблюдателя (Spectator link).
3. Отдать команду `/start`, на просьбу бота предоставить id - отправить идентификатор из п.2.
4. После этого бот раз в 15 секунд проверяет состояние игры и при изменении текущего игрока отправляет уведомление в чат (через N минут, см. ниже).
5. По мере продвижения к концу игры (состоянию, когда Марс полностью терраформирован) бот сообщает о текущем прогрессе при переходе через каждые 10%.

#### Дополнительные возможности
- бот является персистентным, т.е. сохраняет состояние между своими перезапусками, например при необходимости перезагрузки сервера, на котором он запущен;
- поддерживается команда `/pass` для автопропуска следующего хода за игрока, отдавшего команду (и команда `/nopass` для отмены автопропуска);
- поддерживаются команды `/pause` и `/unpause` для выключения и включения бота (с сохранением состояния), например на ночь, когда уведомления неуместны;
- поддерживается команда `/tagme <player>`, включающая обращение бота к игроку по @username для получения уведомлений даже при выключенных уведомлениях из чата (а также команда `/tagmenot` для отмены);
- в некоторых фазах раунда несколько игроков могут ходить одновременно, в таком случае бот перечисляет всех;
- поддерживается команда `/delay N`, которая устанавливает интервал в N минут между тем, как начался отсчет времени хода у очередного игрока, и тем, как бот отправил об этом сообщение;
- в игре существует несколько видов ходов (просто ход, драфт, покупка карт), и бот упоминает конкретный вид, который сейчас ожидается от игрока/игроков.

### Установка и запуск
- Требуется python 3.7 или новее
- Зависимости: `python-telegram-bot` версии 20.0 или новее, установка: `pip install -r requirements.txt`
- Запуск: `python main.py` или `python3 main.py`
- По умолчанию бот запускается с уровнем логирования 10 (DEBUG), другой уровень можно установить с помощью численного аргумента, например `python main.py 20`. Об уровнях логирования см. [здесь](https://docs.python.org/3/library/logging.html?highlight=logging#levels).

Сервер игры, на который настроен бот, - http://terraforming-mars.herokuapp.com/ (можно поднять и свой, тогда нужно поменять сервер в коде).
